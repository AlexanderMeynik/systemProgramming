[На основную страницу репозитория](..%2FREADME.md)

[Описание предоставляемого макета](oldDocForSupportedPackage.md)

[Описание грамматики для входного языка](grammar.md)

# Постановка задачи

Задание на КР дано в следующей общей формулировке:

«Необходимо выполнить доработку элементов макета учебной системы программирования до уровня, позволяющего обрабатывать «новые» для макета конструкции языка высокого уровня, примененные в соответствующем варианте».

Общая формулировка персонализирована в варианте № 23, приведенном на рис. 1.

Персональный вариант № 23:
```pli
    EX23: PROC OPTIONS ( MAIN );
    DCL N BIN FIXED ( 15 ) ;
    DCL S BIN FIXED ( 15 );
    N,S = 0;
    DO WHILE (N<5) ;
    S = S + N;
    N = N + 1;
    END;
    END EX23;     
```
Схема функционирования макета учебной системы программирования, являющегося, согласно заданию на КР, одним из элементов исходных данных, приведена на рис. 2:

![scheme1.png](images%2Fscheme1.png)

Дополнительные требования к КР, вытекающие из рис.2, предполагают то, что данная система программирования работает на технологической ЭВМ  (IBM PC) и является по существу кросс-системой для объектной ЭВМ (IBM 370). В этой системе:

- в качестве языка высокого уровня (ЯВУ) выбран язык, образованный из подмножества языковых конструкций ПЛ1, а исходная программа готовится в виде текстового файла технологической ЭВМ с расширением *.pli,
- язык АССЕМБЛЕРА сформирован из языковых конструкций АССЕМБЛЕРА IBM 370, а ассемблеровский эквивалент исходной программы формируется в виде текстового файла технологической ЭВМ с расширением *.ass,
- объектный эквивалент исходной программы готовится в формате объектных файлов операционной системы ОС  IBM 370 и хранится в виде двоичного файла технологической ЭВМ с расширением *.tex;
- загрузочный эквивалент исходной программы представляет собой машинный код IBM 370, запоминаемый в области ОЗУ технологической ЭВМ, являющейся зоной загрузки для эмулятора объектной ЭВМ.

На рис. 2 жирным контуром выделен компилятор с ЯВУ, являющийся тем элементом макета, результаты модификации которого под персональный вариант № 23 (см. рис 1) приведены в данном отчете.

## 1. Постановка задачи модификации макета в части компилятора с ЯВУ

Схема функционирования модифицированного макетного компилятора с ЯВУ должна соответствовать рис. 3.

![inOut1.png](images%2FinOut1.png)

Функционал модифицированного макетного компилятора должен обеспечить компиляцию исходного текста на ЯВУ (см. рис. 1) в эквивалент исходного текста на Ассемблере (см. рис. 4):

| Метка  | КОП   | Операнды  | Пояснения                                        |
| ------ | ----- | --------- | ------------------------------------------------ |
| EX23   | START | 0         | cчетчик отн. адреса в нуль                       |
|        | BALR  | @RBASE,0  | отн. адр. базы в @RBASE                          |
|        | USING | *, @RBASE | Объявл. @RBASE регистром базы                    |
|        | LH    | @RRAB, @0 | Загрузим @0 в @RRAB                              |
|        | STH   | @RRAB, N  | Сохраним значение @RRAB в N                      |
|        | STH   | @RRAB, S  | Сохраним значение @RRAB в S                      |
| @LOOP  | LH    | @RRAB, N  | Загрузим N в регистр @RRAB                       |
|        | CH    | @RRAB, @5 | Сравним значение в регистре с @5                 |
|        | BC    | 8, @EXIT  | Если N равно @5, то происходит выход из цикла    |
|        | LH    | @RRAB, S  | Загрузим N в регистр @RRAB                       |
|        | AH    | @RRAB, N  | Добавим к содержимому регистра @RRAB значение S  |
|        | STH   | @RRAB, S  | Сохраним содержимое @RRAB в S                    |
|        | LH    | @RRAB, N  | Загрузим N в регистр @RRAB                       |
|        | AH    | @RRAB, @1 | Добавим к содержимому регистра @RRAB значение @1 |
|        | STH   | @RRAB, N  | Сохраним содержимое @RRAB в N                    |
|        | BC    | 15, @LOOP | Переход в начало цикла                           |
| @EXIT  | BCR   | 15, @RVIX | Переход по адр. в рег. @RVIX                     |
| N      | DS    | H         | Выделим 2 байта под N                            |
| S      | DS    | H         | Выделим 2 байта под S                            |
| @0     | DC    | H’0’      |                                                  |
| @5     | DC    | H’5’      |                                                  |
| @1     | DC    | H’1’      |                                                  |
| @RBASE | EQU   | 5         | RBASE назначим 5                                 |
| @RRAB  | EQU   | 3         | RRAB назначим 3                                  |
| @RVIX  | EQU   | 14        | RVIX назначим 14                                 |
|        | END   |           | Конец текста блока                               |


## 2. Постановка задачи модификации макета в части компилятора с АссемблераПостановка задачи модификации макета в части компилятора с Ассемблера

Схема функционирования модифицированного макетного компилятора с Ассемблера должна соответствовать рис. 4.

![inOut2.png](images%2FinOut2.png)

Функционал модифицированного макетного компилятора должен обеспечить компиляцию исходного текста на Ассемблере (см. рис. 3) в его объектный эквивалент (см. рис. 5):


|                                 |
|-----------------------------------------|
| ![objcards1.png](images%2Fobjcards1.png) |
| ![objcards2.png](images%2Fobjcards2.png) |
|   ![objcards3.png](images%2Fobjcards3.png)                                      |
|    ![objcards4.png](images%2Fobjcards4.png)                                                                             |


## 3.Постановка задачи модификации макета в части утилиты загрузки, эмуляции и отладкиПостановка задачи модификации макета в части утилиты загрузки, эмуляции и отладки
Схема функционирования модифицированной макетной утилиты загрузки, эмуляции и отладки должна соответствовать рис. 5.

![inOut3.png](images%2FinOut3.png)

Функционал модифицированной макетной утилиты должен для объектного эквивалента (см. рис 4) обеспечить:

- Формирование **компоновщиком** исполняемого кода программы персонального варианта задания и загрузки его ОЗУ эмулятора,
- Покомандное выполнение исполняемого кода **на эмуляторе**,
- Управление **из отладчика** покомандным режимом работы эмулятора с выдачей протокола отладки.

Для проверки условия выполнения следует проверить значения переменных в начале и конце линейных частей исходного кода, где производиться модификация интересующих переменных(N, S). Под линейной частью подразумевается непрерывный участок кода, исполнение в рамках которого не нарушает инкрементального порядка (порядка, где номер следующей команды всегда на 1 больше, чем у текущей). В исходном коде программы есть 2 места, где эта линейность нарушается: BC 8, @EXIT и BC 15, @LOOP. Таким образом для проверки итераций внутри цикла за начало линейной части примем инструкцию, следующую за BC 8, @EXIT. За конец данного линейного участка следует принять последнюю команду перед BC 15, @LOOP. Линейный фрагмент из команд LH, CH рассматривать не нужно т. к. результаты его исполнения (содержимое в регистре CC и передача управления в нужный адрес) уже видны в начале итерации цикла. Под CC в данном случае подразумевается  регистр Condition Code.

Помимо итераций цикла следует проверить выполнение в фрагменте от начала программы до первой команды BC (включая проверку условия). В конце цикла нет линейного фрагмента, который влияет на значения интересующих переменных.

Поэтому в качестве **критерия** **подтверждения правильного функционирования модифицированной утилиты** может быть принят следующий набор условий:

1. Значения переменных N, S и регистра CC в начале и конце первого линейного фрагмента совпадают с ожидаемыми, представленными в 0 позиции в Таблице 1.
2. Начальное и конечные значения для последнего линейного фрагмента после BC 15, @LOOP до BC 8, @EXIT совпадают с ожидаемыми, представленными в 6 позиции в Таблице 1.
3. Конечное значение N, S, CC совпадает с ожидаемыми, представленными в 7 позиции в Таблице 1.
4. Значения переменных N, S в начале и конце каждой итерации совпадут с ожидаемыми, представленными в 1–5 позициях в Таблице 1.

С учётом линейности выражения внутри цикла для проверки работоспособности программы необходимо сделалась по 2 скриншота на каждую итерацию цикла, а также два скриншота для начального и конечного состояния программы.  Ожидаемые значения переменных и CON, где CON является названием окна визуализации регистра СС на экране отладчика и, соответственно, скриншотов, приведенных далее:

| № позиции    | № итерации/описание блока    | Название | Начало лин. участка | Конец лин. участка |
| ------------ | ---------------------------- | -------- | ------------------- | ------------------ |
| 0            | Первая линейная часть        | N        | 0                   | 0                  |
|              |                              | S        | 0                   | 0                  |
|              |                              | CC       | 0                   | 1                  |
| Начало цикла |                              |          |                     |                    |
| 1            | 1                            | N        | 0                   | 1                  |
|              |                              | S        | 0                   | 0                  |
|              |                              | CC       | 1                   | 1                  |
| 2            | 2                            | N        | 1                   | 2                  |
|              |                              | S        | 0                   | 1                  |
|              |                              | CC       | 1                   | 1                  |
| 3            | 3                            | N        | 2                   | 3                  |
|              |                              | S        | 1                   | 3                  |
|              |                              | CC       | 1                   | 1                  |
| 4            | 4                            | N        | 3                   | 4                  |
|              |                              | S        | 3                   | 6                  |
|              |                              | CC       | 1                   | 1                  |
| 5            | 5                            | N        | 4                   | 5                  |
|              |                              | S        | 6                   | 10                 |
|              |                              | CC       | 1                   | 1                  |
| Конец цикла  |                              |          |                     |                    |
|              | Последнее логическое условие | N        | 5                   | 5                  |
| 6            |                              | S        | 10                  | 10                 |
|              |                              | CC       | 1                   | 0                  |
| 7            | Конец программы              | N        | 5                   | -                  |
|              |                              | S        | 10                  | -                  |
|              |                              | CC       | 0                   | -                  |
